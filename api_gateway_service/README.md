# API Gateway

API Gateway — это центральная точка доступа для всех микросервисов в проекте, которая выполняет следующие основные задачи:

- Аутентификация и авторизация пользователей.
- Маршрутизация запросов к соответствующим микросервисам.
- Агрегация данных с нескольких сервисов и передача клиенту.
- Логирование и мониторинг.
- Ограничение частоты запросов и безопасность.

## Описание

API Gateway предоставляет единый интерфейс для клиентов, проксируя запросы к различным микросервисам, осуществляя необходимые проверки и агрегацию данных.

Сервис использует JWT для аутентификации и маршрутизации запросов. Также включены механизмы логирования запросов и ограничение частоты для обеспечения безопасности.

## Технологии

- **Go** — для реализации сервисной логики.
- **Echo** — веб-фреймворк для реализации REST API.
- **JWT** — для аутентификации пользователей.
- **Prometheus** — для мониторинга.
- **Redis** — для реализации rate-limiting (ограничение частоты запросов).
<!-- - **Kubernetes** — для управления контейнерами и масштабирования.
- **gRPC** — для внутренней связи с микросервисами (опционально). -->

## Структура проекта

api_gateway/   
│  
├── cmd/ # Главная точка входа для приложения.  
│ └── main.go # Запуск сервиса API Gateway.  
│  
├── internal/ # Внутренние пакеты, включающие логику. 
│   ├── auth/ # Логика аутентификации и авторизации.     
│   ├── routes/ # Маршруты и обработчики запросов.    
│   ├── proxy/ # Логика проксирования запросов.    
│   ├── monitoring/ # Логирование и мониторинг.    
│   └── security/ # Реализация защиты, rate-limiting и т.п.    
│     
├── go.mod # Модуль Go.      
├── go.sum # Проверки зависимостей.    
└── Dockerfile # Инструкция для создания Docker-образа

## Разработка

### Основные функции

1. **Аутентификация и авторизация**:
   - Реализовать эндпоинты `/auth/login` и `/auth/register`.
   - Генерация JWT токенов при успешной аутентификации.
   - Верификация токенов в защищённых маршрутах.

2. **Маршрутизация запросов**:
   - Прокси-запросы к соответствующим микросервисам:
     - `/data/ticker/:id` → Data Ingestion Service
     - `/analyze/fractal` → Analysis Service

3. **Логирование и мониторинг**:
   - Логирование каждого запроса и его ответа.
   - Интеграция с Prometheus для мониторинга производительности.

4. **Ограничение частоты запросов (rate-limiting)**:
   - Реализовать механизмы для ограничения частоты запросов с использованием Redis.
   - Применение ограничений на основе IP или токенов пользователей.

### Что нужно реализовать в сервисе API Gateway

1. **Аутентификация и авторизация:**
    - [ ] Разработать систему авторизации пользователей через JWT.
    - [ ] Реализовать эндпоинты для аутентификации: `/auth/login`, `/auth/register`.

2. **Маршрутизация:**
   - [ ] Прокси-запросы к нужным микросервисам (например, `Data Ingestion`, `Analysis`).
   - [ ] Поддержка различных HTTP-методов (GET, POST, PUT, DELETE).

3. **Rate Limiting:**
   - [ ] Реализовать ограничение количества запросов для каждого пользователя или IP.
   - [ ] Использование Redis для хранения состояний и ограничения запросов.

4. **Мониторинг и логирование:**
   - [ ] Интеграция с Prometheus для сбора метрик.
   - [ ] Логирование всех входящих запросов и их результатов для анализа.

5. **Безопасность:**
   - [ ] Защита API Gateway с использованием HTTPS.
   - [ ] Верификация токенов JWT в заголовках запросов.
   - [ ] Внедрение механизма защиты от атак (например, CSRF или XSS).

6. **Масштабируемость и доступность:**
   - [ ] Развертывание через Kubernetes с масштабируемыми репликами.
   - [ ] Использование Ingress для управления входящим трафиком.

7. **Документация API:**
   - [ ] Описание всех эндпоинтов, их параметров и форматов запросов и ответов.
